# Java中线程同步的方式有哪些？详细分析？它们的区别与联系?举例子说明。

> https://www.cnblogs.com/duanxz/p/3709608.html

Java中线程同步方式可以分为6种：

- synchronized修饰方法
- 使用wait和notify
- 使用volatile
- 使用重入锁实现线程同步
- 使用局部变量实现线程同步
- 使用阻塞队列实现线程同步

## synchronized

synchronized是我们经常用到的与线程相关的关键字。

### 关于内置锁

synchronized是Java实现**内置锁**的方式。

什么叫**内置锁**？我的定义是，由Java内部提供的、不需要显式的获取与释放的、用来实现多线程同步功能的一种东西，因为掌握了这个东西就能在线程竞争中拿到权限，拿到资源，所以被称为内置锁。

如何理解呢？假设我们把任意需要线程同步的代码当作是一个房间，那么这个房间的门就是这个内置锁，每个房间与生俱来就带有一扇门，没有门的房间无法提供我们想要的功能，也不能被称之为“房间”。这个门是“房间”的定义决定每个房间必须有个门，内置锁是Java规定的每块代码(资源)能会有这样一个锁。然后，我们通过`synchronized`关键可以拿到这个锁的钥匙。

Java中的内置锁是互斥锁，也就是说这扇门只准一个人通过，最多只有一个线程能获得该锁(打开门，获取资源)。当线程A尝试去获得线程B持有的内置锁时，线程A必须等待或者阻塞，直到线程B释放这个锁，如果线程B不释放这个锁，那么线程A将永远等待下去。

我们可以这样记忆：**synchronized = 内置锁**。

> Tips：一种说法说Java的每个对象都有一个内置锁，它的意思就是每个功能正常的可以被称为"房间"的房子都有一扇门。为什么要有内置锁？因为这是为了方便线程同步，这是Java的设计者设计的。与内置锁相对应的是java.util.concurrent.locks中的显式锁，后面会讲到。

### 内置锁的使用方式

java中对于synchronized内置锁的使用方式，或者说synchronized作用范围，一共三种。

- 同步对象，指定任意非静态对象加锁

```java
private void test() {
    synchronized (objects) {
        // TODO ..
    }
}
```

如同第二章中的线程安全性所讲，线程是否安全取决绝它是否被多个线程访问，如果objects对象线程不安全，可以通过以上方式上锁达到线程安全。

- 同步方法，等同于对this对象加锁

```java
private synchronized void test() {
    // TODO ..
}
```

- 同步类，等同于给静态方法/静态成员变量加锁

```java
private static synchronized void test() {
    // TODO ..
}
```

### String上锁要小心

